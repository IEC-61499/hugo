---
title: 第七章 工业应用实例
description: 工业应用实例
toc: true
authors:
tags:
categories:
series:
date: '2021-01-02'
lastmod: '2021-01-02'
draft: false
weight: 70
---

# 工业应用实例

在本章，我们考虑如何将IEC61499 的概念和标准功能块应用到某些工业控制系统的建模中。

我们特别关注

* 建模一个温度控制系统和它主要的功能块。
* 考虑如何设计传送带控制系统的功能块模型
* 在fuildbus 上运行的系统相关的内容
* 解释在过程控制中应用功能块的某些特殊需要

## 7.1 概述
通过第2-6章，我们已经研究了定义功能块和应用的技术和概念。其中包括了IEC61499架构中的基本单元。如何使用功能块网络对应用程序建模。然后，我们描述了诸如设备，资源的概念，以及应用如何映射到它们之上。

现在我们准备来考虑如何将这些思路结合起来去为某些典型的工业控制问题建模。

本章研究某些应用实例

## 7.2 温度控制实例

我们将考虑的第一个例子是简单的温度控制系统如图7.1 所示。

![图 7.1](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-1.png)

在该应用中，我们有一个热处理炉，比如用树脂来制造医疗产品。炉子有一个加热元件加热。它的温度通过一个传感器测量。我们假设加热器由某种形式的电流调节器控制。例如可控硅堆。温度实际通过热偶精确地测量。对于我们的模型而言，我们只需要考虑该控制系统的高层功能。所以许多细节，诸如加热器如何与电流调节器和传感器连接的问题是不需要了解的。我们假设热电偶的线性化，冷极饱和等都由硬件IO系统中的固件处理。最后，我们假设该控制运行在单一资源的单一设备上。
 
选择这样一个应用是应为它是一个典型的工业仪表和控制问题。有许多的实例中进行过程测量。在这里读取的是温度。然后使用一个算法来调节流或是过程的变量。在这个温度控制例子中，我们假设使用一个简单的PID 算法来检测温度，并且恰当地调节加热器的电流，以保持稳定的温度。类似的模型可用于压力和速度控制环中。

为了保持模型的简单，这个炉子受一个固定的温度控制，也就是说，设置的温度在控制系统配置的使用建立，不能调节。很清楚，实际的设备通常通过外部设备或者通知面板调节。同样，PID 的参数，比如积分/微分时间常量也是固定的。

![图 7.2](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-2.png)

该控制系统的顶层模型如图7.2 所示，该模型由下列功能块

Scan1- 这是Scanner 功能块的一个实例。提供INIT和Scan 事件。INIT 事件触发功能块链中其它功能块的初始化。每隔100ms 产生Scan 事件，周期性地执行其它功能块。

Temp1 -这是在第五章描述的IO_READER 功能块的一个实例。它每次收到REQ 事件输入时，从温度传感器读取最新的值。设备IO 子系统的温度传感器地址用常量#T1_Addr 指定。这个功能块提供了服务接口从设备IO 子系统访问IO 值。当从温度传感器获取新的值后，触发输出事件CNF。

PID1- 这是PID_SIMPLE 功能块的一个实例，提供加热器电流调节的算法。他有两个输入事件INIT和REQ。INIT事件用来初始化PID 算法的内部变量。REQ 触发PID 算法的执行。这引起PID 算法获取最新的过程变量，设置点（SP） 并计算它输出驱动加热器的最新值。当PID 算法运行后，输出事件CNF连同输出OUT 一起产生。注意，每当Temp1 功能块每次收到新的值，产生事件CNF ，PID 算法运行一次。

Heat1- 这是IO_WRITE 功能块的一个实例。它在第五章描述过。用来将PID1 产生的值写入加热器电流调节器。事实上，和Temp1 一样，这个服务接口功能块透过资源接口发送值到设备IO 子系统。在这个场合，将放置在SD_2 的值发送到地址为#H1_Addr 的IO 设备中。注意，PID1每次更新它的输出时，该功能块执行。

顶层模型表明，主要功能被分解成几个功能块。并且清晰地执行控制。如此分块允许修改已经建立的模型。例如，可用将PID_SIMPLE替换成为FUZZY 逻辑控制功能块。

这是一个扫描执行策略的例子。功能块以一个正常重复速率地运行。这是典型的闭环控制设计。在这个例子中，假设更新速率是100ms
用来建立Scan1 的Scanner 功能块类型是一个在第六章中介绍的使用事件功能块构建的复合功能块。

![图 7.3](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-3.png)

见图7.3 它使用一个E_RESTART功能块的实例提供初始化事件INIT,一个C_CYCLE 功能块的实例产生周期事件SCAN。 注意，SCAN 的周期是配置常量T#100ms 定义的，功能块每隔100ms 产生一个事件。

PID_SIMPLE 功能块类型定义成一个基本功能块。 以执行控制图（ECC）和算法规范。算法使用IEC61131-3 高级程序结构文本编写。然而要注意，任何语言都可以用于算法编写。映射FB输入输出的规则定义清晰，这在第三章讨论过。

![图 7.4](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-4.png)

这个功能块的类型规范部分在图7.4 给出。它显示了外部类型规范和内部类型规范。ECC 显示两个状态INIT和RUN_PID 当该功能块收到INIT和REQ 事件时有效。当Init 状态有效时，初始化算法Alg_Init 运行。类似地，当RUN_PID状态有效时，PID 算法Alg_PID 运行。当两个算法完成后，ECC 总是回到初始的Start 状态，图7.2 所示的功能块图显示功能块网络在一个单一的资源上运行。使用服务接口功能模块，同样的模型也能在多个资源上运行，比如PUBLISH 和SUBSCRIBE ，他们在资源间传送数据。例如这个例子可以在两个资源上运行，在4.1.4节的子应用例子中显示。

## 7.3 传送带控制实例

在第二个例子中，我们考虑控制一个传送带的控制。它用来传送零部件通过一个测试站，它是质量验收过程的一部分。测试的部件是电子产品的塑料外壳。我们假设这些部件是注塑机生产的。在这些部件用于生产之前，它必须经过质量检验。检测几个关键参数。主要尺寸，和通过表面的条形码检测部件的标识符。每一项测试的记录都记录在远程服务器上的数据库中。

![图 7.5](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-5.png)

传送带的主要特性显示在图7.5. 它表明传送带由传送带驱动电机驱动。部件从部件输送器传送到质量验收站，一次一个。如果部件的质量参数可接受，也就是尺寸在公差范围内，标识符正确。部件放置到质量合格托盘上，反过来，如果部件不合格，就将部件丢到不合格筐中。一个部件离开传送带，一个新的部件输送到传送带。。传送带能够通过一个装有启动，停止按键的小控制面板，由操作员启动和停止。

![图 7.6](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-6.png)

这个系统的顶层功能块图模型如图7.6所示。为了建立这个模型，我们已经假设控制运行在一个资源上。后面我们考虑将这个设计运行在不同的控制器上。为了保持例子的简单起见，处理·传送带阻塞和例外的情况没有考虑。我们还假设质量参数是固定的，是配置数据的一部分。在实际系统中，这些都需要外部设备，或者控制面板输入。

表示该设计功能的功能块如下：

Exec1 –这是一个Exec功能块类型的实例，这个功能块点燃一个事件链，保持整个控制系统运行，当系统上电时，它通过发送初始化事件INIT 。它也可以产生Stop 事件所有设备停止。

DriveCntl1 这是DriveCntl 功能块的一个实例。该功能块控制电机驱动。它与一个控制面板交互。后面我们将看到内部的设计。当第一次启动时，该功能块产生一个初始化事件INITO。

当电机改变状态时，由“停止”到“运行”，或者由“运行” 到“停止”，会产生一个输出事件EXO 。当皮带运动时，它会保持Running 输出变量为TRUE。当输送器和托盘操作时，Running 必需是TRUE。注意，当EXO 事件产生，并且输出Running 为TRUE，表示电机启动，皮带运动。

Feed1 这是功能类型Feed 的一个实例。用来控制输送部件。从DriveCnt1 出来的EXO 事件传递到Feed1 功能块输送部件。事件Feed输入，Running 变量为TRUE时，引起Feed1 推送一个部件到传送带。如果输送操作成功，该功能块输出Onbelt 输出变量，并且发送一个OK 事件。

QualStation1 -是功能块QualStation的实例。它提供一个接口到质量测试工作站设备。测试通过的变量值在它的Param 输入端传送给它。当功能块收到Check 输入事件，以及由Feed1功能块传递过来的Onbelt 变量开始检查部件的尺寸，扫描部件二维码。当部件在测试工作站通过时，功能块发送Done事件，并设置一组输出。包括：Pass 输出变量，表示部件部件是否通过质量检测。部件标识符，质量数据，部件计数等等。这些值提供给输出变量Identity，QaulData和Count。

Rolloff1 -这是功能块类型RollOff 的实例。提供一个接口到转盘（Roll-off table）和抛弃门机构。当该功能块在它的Run 事件输入端收到来自于测试工作站功能块QualStation1 的Done 事件

它读取Running 和Pass 输入值。如果Running 输入没有证实（asserted） 表示皮带停止，所以没有采取操作。如果皮带运行，Pass 输入为TRUE，启动roll-off 机构将部件移到合格部件台上，如果检测失败，PASS 输入为FALSE,该功能块打开抛弃门，该部件丢入抛弃料斗。

Inventory1-这是功能块类型Inventory的一个实例。提供与远程服务器中数据库的接口。存储来自于部件测试的信息。当这个功能块收到来自于RollOff1 功能块的OK 事件，表示部件已经从皮带上移走。它收集数据发送给远程数据库。输入事件Save 触发功能块采集下列信息： 该部件是否通过质量测试。产品的标识符，质量数据，已测试部件计数。这些数据发送并存储到远程服务器。当数据被成功地接收，并存储到了远程数据库中，该功能块产生一个输出事件Done。这个输出事件回输到Feed1 功能块，触发装入下一个部件。

注意：来自Inventory1的Done 事件回输到Feed1 的地方是事件流合并-用一个圆点表示。在第六章中讨论过，这是一个标准事件功能块E_Merge 实例的图形简写
 
这一传送带实例中，功能块执行时间与沿着皮带的部件传送速度同步。当上一个部件从皮带上移走，数据处理完后，Feed1 才触发输送下一个部件。这和上一个温度控制实例中扫描执行策略有明显的对比。
 
Exec 功能块的设计如图7.7所示。

![图 7.7](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-7.png)

这是将一个标准时间功能块E_RESTART 重新封装成为一个新的功能块类型的例子。简化了外部接口。

D-riveCnt1 是一个复杂的复合功能块的例子，如图7.8 所示。

![图 7.8](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-8.png)

它提供了下列功能：

它从一个控制面板上连续地读取启动和停止按键的值，比如 每隔100ms

- 当面板请求改变状态时，它设置电机驱动状态，比如 “运行”或者“停止”，将这些写入电机驱动执行部件

- 当面板和电机IO 成功地初始化后，它产生一个初始化 事件

- 当电机状态发生变化时，它产生一个EXO事件。

查看该功能块的内部设计我们发现，一个E_CYCLE 事件功能块类型的实例Cycle，它产生时间间隔为100 毫秒的事件流。这些事件用来请求读取控制面板按键的值。也就是使用Rd_Panel1,为了简化起见，假设面板按键能读取一个布尔值，TRUE 表示启动，FALSE 表示停止。Run 状态保留在一个SR 单稳态 功能块EnableRun 中。它是在第六章曾经讨论过的E_SR 的实例。 Rd_Panel 输出的RD_1 的上升沿设置Run 状态。当启动按键按下时，Rd_Panel1 设置为TRUE。当停止键按下，RD_1 为FALSE，或者收到一个stop 输入事件，单稳态EnableRun 复位。一旦EnableRun 的状态发生变化输出Q，会产生一个EQ 输出事件。这用来触发一个请求事件REQ 到Wrt_Motor 功能块。改变电机执行器的状态。当电机执行器完成状态改变，也就是它完成了“Off和”，On 的转换。Wrt_Motor功能块产生一个确认事件CNF 这用来产生最后的输出事件EXO

Rd_Panel 和Wrt_Motor 是服务功能块IO_READ 和IO_WRITE 的实例。我们在第五章描述过。用来提供设备IO子系统读输入和写输出的接口，我们现在能够勾画出在传送带测试工作站例子中其它功能块的设计。

FeedFB 类型- 提供了与输送机构的接口。它的设计同样使用服务接口功能块IO_WRITE 和IO_READER ，用来写输出到执行器的值和读取传感器的值。操作输送器的操作和电机驱动。

QualStationFB类型-提供了质量测试工作站设备的接口。该设计再一次使用服务接口功能块类型IO_WRITE和IO_READER.用来操作和读取测试设备和光电检测单元的值。条码读取设备的接口使用串口通信，能使用另外一个服务接口功能块。

RollOff FB类型 -提供roll-off 机构和抛弃门的接口，同样，这一功能有服务接口功能块IO_WRTE 和IO_READER的实例建模，用来读取各种执行机构和传感器的值。

Inventory FB 类型-它提供存储质量数据的远程数据库的接口。它的设计将输入数据转换成为适合数据库的格式。为了传送数据到数据库，要使用CLIENT 功能块类型。
 
### 7.3.1 分布式系统模型
我们现在来考虑如何将传送带测试站的系统模型分布化，功能分布在不同的控制器（也就是设备）上运行。注意，如果我们使用正确的IEC61499 术语。任何能够支持资源的东西，都是IEC61499 设备。我们假设用户面板和电机执行器控制放置在一个设备 Device_A 上，而其它处理部件输送，测试设备和roll-off 机构的功能放置在设备 Device_B  上。

![图 7.9](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-9.png)

两个设备如图7.9 所示，通过本地网连接。网络的类型并不影响顶层模型的设计。假设它提供两个设备之间可靠的通信链路。在这个例子中，我们假设使用某种形式的工业以太网能够使用一种网络地址，可靠地从一个设备发送数据到另一个设备。

应用设计现在将分成两个资源，放置在两个设备中。为了连接应用的两个部分，要使用两个额外功能块类型PUBLISH和SUBSCRIBE的实例。

![图 7.10](https://cdn.jsdelivr.net/gh/IEC-61499/img@21.1/Fig7-10.png)

如图7.10 所示，它们被添加了进去。这些服务接口功能块用来在通信链路或者网络上可靠地传送数据。PUBLISH 功能块Pub1 使用一个特定的表示符发送数据，在设计中表明，它是使用配置常量#Addr1 来表示的。SUBSCRIBE 功能块Sub1 用来接收PUBLISH功能块发送的数据。Pub1和Sub1 可以认为是成对的。它们一起实现了图7.6 单一资源模型中的DriveCnt1和Feed1  之间的通信。
 
可以想象，当应用被分拆成为几部分，分布在不同的资源时，建立功能块网络的工具能够自动地插入合适的服务接口功能块。
尽管网络的类型对于高层建模时并不重要，显然，涉及的性能，可靠性是需要考虑的。例如 发送REQ 发布数据，到收到数据产生RSP 事件的时延可能会影响整个模型和系统设计。

注意： 每个资源需要它们自己的初始化事件启动功能块执行/一个额外的E_RESTART 功能块要添加到Device_B 的模型中。Resource1 要保证这一段应用网络被初始化。

同样要注意的是，来自于SUBSCIBE功能块的输出事件IND反馈到了输入事件RSP。该事件是通知SUBSCRIBE 功能块，该数据已经处理了。这样做是为了保证SUBSCRIBE 功能块总是监听下一个由PUBLISH 功能块发送的数据项。 

## 7.4 Fieldbus应用

新的智能化工厂传感器和执行器现在呈现在工业控制领域。它们结合了内建的过程处理能力和标准的通信接口。这样的设备分类成为现场总线（Fieldbus device）设备。-尽管它们不使用相同的通信标准。

## 7.5 结束语

## 7.6 小结
