---
title: 第六章 事件功能模块
description: 事件功能模块
toc: true
authors:
tags:
categories:
series:
date: '2021-01-02'
lastmod: '2021-01-02'
draft: false
weight: 60
---

# 事件功能模块

## 6.1 概述

在前面几个章节，我们研究了建立功能块定义的各种方法，它们包括基本，复合和服务接口功能块。

在这一章，我们将研究在IEC61499 标准中定义的一组特殊的功能块类型。它们专门用来处理事件。大多数这种功能块定义成为基本功能块。一对功能块定义成为服务接口功能块，它们需要和包含的资源某些交互。还有一些复杂一点的功能块，它们从基本的事件功能块构成复合功能块。

所有标准事件功能块设计成可以用于定义大的用户定义复合功能块和应用。

提供许多建模事件行为的功能操作。

在任何面向事件的系统中，总需要能够生成初始化事件。触发软件第一项的执行。同样，在IEC61499 功能网络中，需要有一个事件来触发一串功能块中的第一个功能块。控制系统通常需要其它的需要，比如分离事件，同时触发多串功能块。或者产生一系列事件，使功能块能够定期地重复执行。比如，为一个扫描IO的系统建模。
   
图6.1 显示了一个简单的控制系统的例子，当系统初始化上电时开始执行，也就是“冷启动”。然后，继续并行地执行两串功能块。显然需要一个“冷启动”事件启动串中的第一个功能串。当第一个功能块FB1 完成它的执行，然后需要执行分离的两串功能块。从图中可见，使用了一个事件分离器（event split） 触发功能块FB2a和FB3a。当FB2b和FB3b 两者都完成了它们的执行，使用一个集合点（rendezvous）将这两个功能块输出的事件合并成一个事件。然后依次点燃最后的一个功能块FB4。

在这个例子中，当系统冷启动时，功能块只执行一次。因为只有一个初始化事件产生。典型的控制系统通常需要扫描行为。功能块需要反复地执行，已监控工厂的状态，更新执行器等等。这可以通过传递一串事件到第一个功能块来实现。如图6.2 所示。假设事件串有时间间隔为100ms 的周期性时间流。现在两个并行路径上的所有功能块在冷启动后，连续地每隔100ms 执行一次。
 
在图6-1和6-2，每个圆圈表示某种时间传递行为。我们看到，每个圆圈可以使用一个IEC61499 事件功能块来替换。图6.2中功能网络下面显示了进入功能块FB1的事件控制头的事件流和从集合点出来的合并事件流的时序图。

注意：这里事件是相对有些时延的。在并行功能块中执行算法以及资源调度需要一些时间。事件之间的周期也有些小小的变化，因为执行时延会有所不同。例如，一个算法不一定需要相同的执行时间。它们会根据输入值和内部变量而不同。

## 6.2 标准事件功能模块类型

我们现在来综述在IEC61499 标准中定义的丰富的标准事件功能块，实现各种不同方案的事件模型。

### 6.2.1 事件分离器（Event splitter）

事件分离器当接收到一个单一的输入事件时，产生两个或者多个同时的输出事件。如图6.4 所示

### 6.2.2 事件合并（Event Merger）

事件合并通过合并从输入事件EI1  到EIn 进入的事件产生一个单一的输出事件流。它能用来合并两个或者更多事件（图6.5）

### 6.2.3 两个事件集合（Two Event Rendezvous）

两事件集合等待接收到两个输入事件EI1和EI2上的各自的事件后，在输出EO 上输出一个输出事件。如果该功能块在两个EI1和EI2 输入上继续受到分别的事件，它将进一步在EO产生输出事件（图6.6）

注意： 任何时候该功能块在输入R收到一个复位事件，那么在进一步在EO 上产生输出事件需要接收到两个输入事件EI1和EI2上的各自的事件。

处理其它多个输入事件的集合功能块采用类似的设计。

### 6.2.4 允许事件传递（Permissive Event Propagator）

允许事件传递功能块根据输入PERMIT 的值来控制输入EI 到EO 的事件流。TRUE 值允许事件通过该功能块（图6，7）。

### 6.2.5 事件选择器（Event Selector）

事件选择器允许根据G 的值为TRUE 还是FALSE，来分别选择EI0 或者EI1 输出事件流。（图6.8）
 
### 6.2.6 事件切换（Event Switch）

事件开关能用来引导EI 进入的事件流到输出事件EO0 或者EO1。G 设为FALSE 将该事件切换到输出EO 0 ，G 设置TRUE ，将该事件切换到输出EO 1（图6.9）。
 
### 6.2.7 延时事件传递（Delayed Event Propagator）

延时事件传递提供了将从输入START到达的事件延时一个有输入DT 延时的周期。例如，如果DT 设置为100ms，当输入START 到达的事件延时100ms 后在 输出EO上输出一个事件（图6.11）
  
### 6.2.8 重启事件生成器（Restart Event Generator）

重启事件发生器当资源冷和热启动，或者资源被外部停止时，提供单一的事件。大多数应用需要一个这样的功能块实例去启动一个触发事件启动在网络中的一串功能块启动执行。如图6.1和6.2所示。这个功能块需要和资源交互。所有要使用服务序列图来描述（图6.11）
 
### 6.2.9 周期事件发生器（Cyclic Event Generator）

周期事件发生器用来周期性地产生一个事件流。当输入START 到达一个事件时，该事件流启动。当输入STOP 到达一个事件时停止。输出事件的周期由DT的值设置。

该功能块描述成为使用延时事件传递（Delayed Event Propagator）E_DELAY 的实例构成的复合功能块。从START 到EO 的反馈路径保证当初始化事件后延时产生新事件，后面会周期性地产生输出事件。（图6-12）

### 6.2.10 事件队列发生器（Event Train Generator）

事件队列发生器产生一系列给定时间间隔的事件到输出EO。事件的数量由输入N 设定，时间由输入DT 设定。输出事件的数量达到时，在输出CV 上输出事件。
 
### 6.2.11 事件队列表驱动发生器（Event Train Table-driven Generator）

事件队列表驱动发生器在输出EO上提供了一事件队列。事件的数量和事件间隔能够指定。事件的数量由输入N 给定，在输入DT的TIME 数组定义了每个序列化输出事件之间的间隔。那么第一个事件和第二个事件之间的间隔为TIME[0],第二个事件和第三个事件之间的间隔为TIME[1],如此下去（图6.14）
 
注意：如果数组的大小为m，那么N的值必需是m+1.例如，如果在队列中有5个输出事件，那么需要有四个间隔的时间队列。

### 6.2.12分离事件表驱动发生器（Separate Event Table-driven Generator）

分离事件表驱动发生器用来在每个事件输出端输出一个事件；每个事件由一个事件间隔分离。事件的数量由输入N 定义，输出事件之间的间隔由DT设置的时间数组确定（图6.15）。

例如 假设输入DT的是一个大小为4的时间数组，也就是TIME[4],输入N设置为4 功能块定义为有4个输出事件。那么当事件到达START，在一个时间周期TIME[0】在输出事件EO0 端输出一个事件。在时间间隔TIME[1]后在输出事件EO1 产生一个事件。以此类推，直到4个输出事件都点燃一遍。如果在STOP 收到一个事件，输出事件将被停止。后续的START 事件能够触发新的一组输出事件。
 
这个功能块定义成为复合功能块。由一个事件队列表驱动发生器和一个事件多路解复用器构成（Demultiplexor）

### 6.2.13 事件驱动双稳态（Event-driven Bistable）

事件驱动双稳态锁存一个事件。当“set”输入S 为TRUE 时，输出为TRUE，当“reset”输入R的事件到达时，Q被清除为FALSE。
 
IEC61499 定义了第二种事件驱动双稳态事件功能块，叫做E_RS 尽管这个功能块额接口顺序发生了改变，R在S的前面（如图6.17）但是它提供了和E_SR 相同的行为。安排两个版本是为了和IEC 61131-3 中对应的类型兼容。

### 6.2.14 D型数据锁存器（D (data latch) Bistable）

数据锁存双稳态器当时钟输入事件（CLK）到达时存储布尔输入D的状态。如果输入状态反向，产生一个输出事件EO，存储的布尔状态输出在Q上。
 
### 6.2.15 布尔上升沿检测器（Boolean Rising Edge Detector）

布尔上升沿检测器当输入QI 在两个连续事件E1之间，输入QI 从FALSE 变化到TRUE 时，产生一个输出事件EO。图6.19的时序图是最好的描述。
 
这是一个由数据锁存器和事件切换（Event Switch）功能模块构成的复合功能块。因为数据锁存器只有当输入改变状态时才产生一个输出事件。事件切换器保证了只有正跳变被选择。

### 6.2.16 布尔下降沿检测器（Boolean Falling Edge Detector）

布尔下降沿检测器当输入QI 在两个连续输入事件E1之间 从TRUE 变化到FALSE 时，产生一个输出事件EO 。图6-20 的时序图是最好的描述。布尔下降边缘检测器和布尔上升沿检测器具有类似的设计。
 
### 6.2.17 事件驱动上升计数器（Event-driven Up Counter）

事件驱动上升计数器对在输入CU 到达的输入事件计数。每次输入事件计数后，产生一个CUO 事件。事件的计数值在CV 输出。当计数值达到PV 的值时，将不再输出事件，计数值保持PV 值不变。输出Q 设置成为TRUE 表示事件计数器完成。

R 上的复位事件对计数器复位。CV 计数器清零，产生输出事件RO 。
 
## 6.3 在事件流控制中使用事件功能模块

软件工具在他们的标准功能块库中定义了这些功能块的定义。它们支持控制应用中不同任务的精确建模。它们从控制基本的事件流，到控制表示小型控制任务的条件事件流。

### 6.3.1 基本事件流控制
我们现在能够来描述图6.2所示的周期时间链例子，来看标准事件功能块来对事件建模。

图6.22 

冷启动事件由重启动事件发生器的一个实例(见FB_E3)提供。两个功能块链周期执行的事件序列是由一个事件周期发生器（Event Cyclic Generator 见FB_E4）产生。冷启动事件和这个事件序列使用事件合并器（Event Merger FB_E5）合并的事件流用来触发FB1的执行。FB1 出来的合并事件流使用事件分离器分离成为两个事件流，用于执行两个功能块链。
 
### 6.3.2 条件事件传递（Conditional event propagation）

### 6.3.3 控制任务建模

## 6.4 小结
